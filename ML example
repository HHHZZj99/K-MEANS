#linear regression
##import first
model1<-lm(log(sale.proce.n)~log(gross.sqft),data=bk.homes)
bk.homes[which(bk.homes$gross.sqft==0),]
bk.homes<-bk.homes[which(bk.homes$gross.sqft>0&bk.homes$land.sqft>0),]
model1<-lm(log(sale.price.n)~log(gross.sqft),data=bk.homes)
summary(model1)

plot(log(bk.homes$gross.sqft),log(bk.homes$sale.price.n))
abline(model1,col="red",lwd=2)
plot(resid(model1))

model2<-lm(log(sale.price.n)~log(gross.sqft)+log(land.sqft)+factor(neighborhood),data=bk.homes)
summary(model2)
plot(resid(model2))

#leave out intercept for ease of interpretability
model2a<-lm(log(sale.price.n)~0+log(gross.sqft)+log(land.sqft)+factor(neighboehood),data=bk.homes)
summary(model2a)
plot(resid(model2a))

#add building type
model3<-lm(log(sale.price.n)~log(gross.sqft)+log(land.sqft)+factor(neighborhood)+factor(building.clss.category),data=bk.homes)
summary(model3)
plot(resid(model3))

#interact neighborhood and building type
model4<-lm(log(sale.price.n)~log(gross.sqft)+log(land.sqft)+factor(neighborhood)*factor(building.class.category),data=bk.homes)
summary(model4)
plot(resid(model4))






#KNN
require(gdata)
require(geoPlot)
require(class)

mt<-read.xls("rollingsales_manhattan.xls",pattern="BOROUGH",stringAsFactors=FALSE)
head(mt)
summary(mt)

names(mt)<-tolower(names(mt))

mt$sale.price.n<-as.numric(gsub("[^[:digit:]]","",mt$sale.price))
sum(is,na(mt$sale.price.n))
sum(mt$sale.price.n==0)
names(mt)<-tolower(names(mt))

##clean the data with regular expressions
mt$gross.sqft<-as.numeric(gsub("[^[:digit:]]","",mt$gross.square.feet))
mt$land.sqft<-as.numeric(gsub("[^[:digit:]]","",mt$land.square.feet))

mt$sale.date<-as.Date(mt$sale.date)
mt$year.built<-as.numeric(as.character(mt$year.built))
mt$zip.code<-as.character(mt$zip.code)
